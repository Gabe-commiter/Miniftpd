# 项目概述
本项目是Linux下vsftp服务器的简化版，实现了vsftp的部分功能。实现了FTP的两种工作模式：被动模式和主动模式。这里的主动模式和被动模式都是站在服务器的角度上来说的。主动模式：cli要把自己的IP+PORT告诉ser,ser主动去连接cli。被动模式：ser告知cli自己的IP+PORT，等待cli来连接自己。

**为什么一定要分主动模式和被动模式呢？**

客户端处于NAT网络之后--主动模式，服务器只能得知NAT的地址而不知道客户端的IP地址，因此FTP服务器会以20端口主动向NAT的PORTBB发送主动连接，但NAT并没有开启BB端口，因而连接被拒绝。所以这时候就需要被动模式，被动模式的控制连接和数据连接都是由客户端发起的，这样就不会出现服务器到客户端的数据端口的入方向连接被防火墙拦截的问题。

项目的整体架构梳理如下：采用多进程模型来实现同时为多个客户端服务的功能。启动服务器程序之后，运行一个主进程。每当有一个客户端到达的时候主进程就会派生出一个子进程来为客户端服务。随后子进程会开启一个会话，再次fork派生出一个子进程。其中nobody进程用来协助ftp进程建立主动/被动模式的数据连接，ftp进程负责处理客户端请求的FTP服务。通过capabilities提升权限，使得nobody进程可以操作20端口（众所周知端口）。此外通过socketpair来作为nobody进程和ftp进程之间的通信手段，项目中专门设计了一个privsocket模块用来实现此功能。

项目中的一些技术点：
- 鉴权登录
- 列表显示
- 上传和下载功能实现
- 断点续传
- 限速
- 控制连接--空闲断开
- 数据连接--空闲断开
- 最大连接数的限制
- 每IP连接数的限制
